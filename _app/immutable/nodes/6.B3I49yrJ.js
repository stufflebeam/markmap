import"../chunks/disclose-version.Bg9kRutz.js";import{p as S,a as C,g as o,s as F,b as i,d as l,c as H,e as P,r as x}from"../chunks/utils.DFTM5cE0.js";import{a as z,t as A}from"../chunks/template.BXSVluzr.js";import{b as E,p as c}from"../chunks/preload-helper.DYWTPbcH.js";import{o as R}from"../chunks/index-client.DL5hyya7.js";import{i as U,g as O}from"../chunks/common.CZzrYGnM.js";import{M as V}from"../chunks/markmap.Bz-a7i1N.js";import{T as X}from"../chunks/toolbar.KL-kZR4-.js";var j=A('<div class="relative w-screen h-screen overflow-hidden"><!> <!></div>');function Y(v,h){S(h,!0);let u=i(!1),r=i(void 0),d=i(""),f=i(!0);const b={setData(e){l(d,c(e))},setCursor(e){o(r).setCursor(e)},setFit(e){l(f,c(e))},downloadSvg(){var a,n;const e=(n=(a=o(r))==null?void 0:a.getMarkmap())==null?void 0:n.svg.node();if(!e)return;const t=new XMLSerializer().serializeToString(e);s("downloadSvg",t)},downloadHtml(){const e=O();if(!e)return;const t=e.transform(o(d));s("downloadHtml",{result:t})},updateTheme(e){U.set(e)}};function p(e){const{type:t,data:a}=e.data,n=b[t];n==null||n(a)}function s(e,t){parent.postMessage({type:e,data:t},window.location.origin)}function M(){s("getData")}function k(){l(u,!0)}function L(){o(r).getMarkmap().g.selectAll(function(){return Array.from(this.childNodes).filter(t=>t.tagName==="g")}).on("dblclick.focus",(e,t)=>{var w;const a=(w=t.payload)==null?void 0:w.lines,n=+(a==null?void 0:a.split(",")[0]);isNaN(n)||s("setCursor",n)},!0)}function T(){s("goToFullPage")}function _(){window.location.reload()}function y(e){const t=new URL(e,window.top.location.href);return t.origin===window.location.origin?s("navigate",e):window.open(t,"_blank"),!1}R(()=>(window.addEventListener("message",p),M(),()=>{window.removeEventListener("message",p)}));var m=j(),g=H(m);E(V(g,{class:"w-full h-full",get fit(){return o(f)},get content(){return o(d)},onLoad:k,onUpdate:L,onReload:_,onOpenLink:y}),e=>l(r,c(e)),()=>o(r));var D=F(g,2),N=P(()=>{var e;return o(u)?(e=o(r))==null?void 0:e.getMarkmap():void 0});X(D,{class:"absolute right-0 bottom-0 mr-2 mb-2",get markmap(){return o(N)},onFullPageView:T}),x(m),z(v,m),C()}export{Y as component};
