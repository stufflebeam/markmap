import"./disclose-version.Bg9kRutz.js";import{p as X,u as Y,f as Z,t as x,a as $,s as L,g as m,b as tt,h as et,d as _}from"./utils.DFTM5cE0.js";import{i as at,e as nt}from"./if.CnkSTwZ2.js";import{a as p,t as E}from"./template.BXSVluzr.js";import{a as it,e as st,u as rt,g as R,b as ot,c as ct,k as ft,J as lt,l as mt,s as A}from"./common.CZzrYGnM.js";import{s as dt}from"./class.DZt6Potx.js";import{b as ut,p as T}from"./preload-helper.DYWTPbcH.js";import{p as k}from"./props.CtMWV0K4.js";import{o as ht}from"./index-client.DL5hyya7.js";import{d as gt}from"./debounce.CLTjDgnO.js";var yt=E('<link rel="stylesheet" type="text/css">'),vt=E('<div class="markmap-highlight-area"></div>'),wt=E('<!> <!> <svg xmlns="http://www.w3.org/2000/svg"></svg>',1);function qt(O,i){X(i,!0);let u=k(i,"content",7,""),S=k(i,"style",3,""),D=k(i,"fit",3,!0),F=k(i,"class",3,"");const j=it(),M={};let s,b,h;const g={};let c=tt(void 0);function B(t,e){let a=!1;return{promise:new Promise((r,f)=>{const o=performance.now(),l=()=>{const d=performance.now()-o,y=Math.min(d/t,1);if(e(y),y<1&&!a)return requestAnimationFrame(l);(a?f:r)()};requestAnimationFrame(l)}),abort:()=>{a=!0}}}function H(t,e){const n={key:Symbol("highlight"),x:t.x,y:t.y,width:t.width,height:t.height,opacity:1,scale:(e.width+8)/e.width};_(c,T(n));const{abort:r,promise:f}=B(500,o=>{var l;if(n.key!==((l=m(c))==null?void 0:l.key))return r();n.opacity=1-o,_(c,T(n))});f.finally(()=>{var o;n.key===((o=m(c))==null?void 0:o.key)&&_(c,void 0)})}function P(){return s}async function U(t){var a;if(!s)return;const e=I(t);if(e){await s[M.placement==="center"?"centerNode":"ensureVisible"](e,{bottom:60});const n=(a=s.findElement(e))==null?void 0:a.g,r=n==null?void 0:n.querySelector("foreignObject"),f=r==null?void 0:r.getBoundingClientRect();f&&H(f,e.state.rect)}}const C=gt(()=>s.fit(),200);let N;async function v(t,e=!1){var a,n,r,f;if(s&&(t!==N||e)){h=R().transform(t||"");const o=(a=h.frontmatter)==null?void 0:a.markmap;M.placement=(n=o==null?void 0:o.activeNode)==null?void 0:n.placement;const l=ft(o),{extraJs:d,extraCss:y}=o||{};g.js&&!V(g.js,d)?(r=i.onReload)==null||r.call(i):!g.js&&d&&(g.js=d,G()),g.css=y,N=t,await s.setData(h.root,{...lt,...l}),(f=i.onUpdate)==null||f.call(i),D()&&await s.fit()}}function V(t,e){return Array.isArray(t)&&Array.isArray(e)&&t.length===e.length&&t.every((a,n)=>a===e[n])}async function G(){await j,await mt(g.js.map(t=>({type:"script",data:{src:t}}))),v(u(),!0)}function I(t){function e(n){var o,l,d;const[r,f]=((l=(o=n.payload)==null?void 0:o.lines)==null?void 0:l.split(",").map(y=>+y))||[];r>=0&&r<=t&&t<f&&(a=n),(d=n.children)==null||d.forEach(e)}let a;return h!=null&&h.root&&e(h.root),a}function K(t){var a,n;const e=(a=t.target)==null?void 0:a.closest("a");if(e){const r=e.getAttribute("href");((n=i.onOpenLink)==null?void 0:n.call(i,r))===!1&&t.preventDefault()}}Y(()=>{u(u()),et(()=>{v(u())})});async function Q(){var e;await j;const t=[rt.tap(()=>{v(u(),!0)}),R().hooks.retransform.tap(()=>{v(u(),!0)})];return s=ot.create(b),v(u()),(e=i.onLoad)==null||e.call(i),window.addEventListener("resize",C),()=>{var a;window.removeEventListener("resize",C),t.forEach(n=>{n()}),(a=s==null?void 0:s.destroy)==null||a.call(s),s=void 0}}ht(()=>{const t=Q();return()=>{t.then(e=>e==null?void 0:e())}});var q=wt(),z=Z(q);st(z,17,()=>g.css||[],ct,(t,e)=>{var a=yt();x(()=>A(a,"href",m(e))),p(t,a)});var J=L(z,2);{var W=t=>{var e=vt();x(()=>A(e,"style",`left:${m(c).x}px;top:${m(c).y}px;width:${m(c).width}px;height:${m(c).height}px;opacity:${m(c).opacity};transform:scale(${m(c).scale})`)),p(t,e)};at(J,t=>{m(c)&&t(W)})}var w=L(J,2);return ut(w,t=>b=t,()=>b),x(()=>{dt(w,`${F()} leading-none`),A(w,"style",S())}),nt("click",w,K),p(O,q),$({getMarkmap:P,setCursor:U})}export{qt as M};
